
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoftLABWEB SRF History</title>
    <link rel="icon" type="image/x-icon" href="/static/image/p2logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <style>
        body {
            background-color: #F5F5F5;
        }

        table {
            min-width: max-content;
            border-collapse: separate;
            border-spacing: 0px;
        }


        table th {
            position: sticky;
            top: 0px;
            background: #133b5c;
            color: white;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
            outline: 0.7px solid black;
            border: 0.5px solid black;
            padding: 55px;
        }

        table th,
        table td {
            padding: 5px;
            padding-top: 5px;
            padding-bottom: 5px;

        }

        table td {
            text-align: left;
            font-size: 12px;
            border: 1px solid rgb(177, 177, 177);
            padding-left: 20px;
            padding-top: 5px;
            /* Adjust the top padding */
            padding-bottom: 5px;
            /* Adjust the bottom padding */
        }

        .container {
            display: flex !important;
            padding: 20px;
        }

        .outer-wrapper {
            margin-top: -500px;
            margin-left: 20%;
            border: 1px solid black;
            border-radius: 4px;
            box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.9);
            width: 80%;
            max-height: fit-content;
        }

        .table-wrapper {
            overflow-y: scroll;
            overflow-x: scroll;
            height: fit-content;

            height: 67vh;
        }

        th.resize {
            position: relative;
        }

        th.resize::after {
            content: "";
            position: absolute;
            top: 0;
            right: -5px;
            bottom: 0;
            width: 10px;
            cursor: col-resize;
        }




        #str {
            position: sticky;
            background: #3C486B;
            color: white;
            z-index: 1;
            left: 0;

        }

        .inst {
            overflow-y: scroll;
            overflow-x: scroll;
            width: 20%;
            height: 500px;
            background-color: white;
            cursor: pointer;
            margin-top: 30px;


        }

        .clickable-row {
            cursor: pointer;
            color: black;
        }

        .clickable-row:hover {
            cursor: pointer;
            color: rgb(53, 19, 245);

        }

        #excel {
            margin-top: 10px;
            margin-left: 700px;
        }

        table tbody tr:nth-child(even) {
            background-color: white;
        }

        table tbody tr:nth-child(odd) {
            background-color: #f9fafa;
        }
    </style>
</head>

<body>

    <div id="navbar-placeholder"></div>

    <script src="{{ url_for('static', filename='js/departmentnav.js') }}" type="module"></script>
    <script>
        // Retrieve valueStoredInVariable from localStorage
        var storedValue = localStorage.getItem('valueStoredInVariable');
        console.log(storedValue);
        // Now you can use valueStoredInVariable in this script or any other script on this page.
        // Check if valueStoredInVariable is defined
        if (storedValue === "Customer Care") {
            fetch('/navbar')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else if (storedValue === "ETL-Electro Technical Lab") {
            fetch('/navbardepartmentcal')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else if (storedValue === "PRL-Pressure Lab") {
            fetch('/navbardepartmentcal')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else if (storedValue === "MCL-Linear") {
            fetch('/navbardepartmentcal')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else if (storedValue === "MCL-Mass") {
            fetch('/navbardepartmentcal')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else if (storedValue === "QA") {
            fetch('/navbardepartmentqa')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else if (storedValue === "System Administrator") {
            fetch('/navbardepartmentsa')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar-placeholder').innerHTML = data;
                });
        } else {
            console.log("No conditions matched.");
        }
    </script>

    <div class="head" style="display: flex; align-items: center;">

        <input type="text" id="searchInput" class="form-check-input" placeholder="Search All Data"
        style="width: 18%;height:28px; margin-left: 4px; ">


        <label class="col-form-label" for="ULRPrefix"
            style="font-weight: bold; margin-top: 10px; margin-left: 22%;">Active SRF Prefix:</label>
        <select class="form-select" id="ULRPrefix" name="ULRPrefix" style="width: 20%; margin-top: 10px;" required>

            {% for prefix in prefixs %}
            <option value="{{ prefix }}" {% if selected_dept==department %}selected{% endif %}>
                {{ prefix }}
            </option>
            {% endfor %}


        </select>
   


    </div>
    <section class="left">
        <div class="inst">
            <h5 style="background-color: black; color: white; position: sticky;">Inst.ID.NO</h5>
            {% for user in users %}
            <P class="clickable-row" data-user-id="{{ user }}" style="margin-left: 20px;">{{ user }}</P>
            {% endfor %}
        </div>

    </section>
    <div class="outer-wrapper">
        <div class="table-wrapper">

            <div class="container">
                <div class="section1">
                    <table id="emp-table">
                        <thead>
                            <th col-index="1" class="resize" id="str">Excel Certificate

                            </th>
                            <th col-index="2" class="resize" id="str">Obs.Sheet

                            </th>
                            <th col-index="3" class="resize" id="str">Scanned Certificate

                            </th>
                            <th col-index="4" class="resize" id="str">Server Cert.Loc.

                            </th>
                            <th col-index="5" class="resize" id="str">Department

                            </th>
                            <th col-index="6" class="resize" id="str">SRF Job Card No.

                            </th>
                            <th col-index="7" class="resize" id="str">SRF Job No.

                            </th>
                            <th col-index="8" class="resize" id="str">Cal.Date

                            </th>
                            <th col-index="9" class="resize" id="str">Next Due Date

                            </th>
                            <th col-index="10" class="resize" id="str">ULR No.

                            </th>
                            <th col-index="11" class="resize" id="str">W.O.No.

                            </th>
                            <th col-index="12" class="resize" id="str">Inst.ID.NO.

                            </th>
                            <th col-index="13" class="resize" id="str">Report No

                            </th>
                            <th col-index="14" class="resize" id="str">Uploaded Status.

                            </th>
                            <th col-index="15" class="resize" id="str">Report Approved Status.

                            </th>


                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <form action="/" method="post">
        <button type="submit" class="btn btn-success" id="excel">Download</button>
    </form>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>




  




    <script>
        $(document).ready(function () {
            // Handle row clicks
            $(".clickable-row").click(function () {
                var userId = $(this).data("user-id");
                console.log("Selected Value: " + userId);

                // Send the selected row data to the Flask backend using AJAX
                $.ajax({
                    type: "POST",  // You can also use GET or other HTTP methods
                    url: "/click_history",  // Replace with your Flask endpoint URL
                    data: { "user_id": userId },

                    success: function (response) {
                        // Handle the response from the backend
                        console.log(response);

                        var tableBody = $("#emp-table tbody");
                        tableBody.empty();  // Clear existing table rows

                        if (Array.isArray(response)) {
                            response.forEach(function (user) {
                                // Format dates (assuming 7th and 8th positions are dates)
                                var rawDate1 = user[7];
                                var dateObj1 = new Date(rawDate1);
                                var formattedDate1 = `${(dateObj1.getMonth() + 1).toString().padStart(2, '0')}/` +
                                    `${dateObj1.getDate().toString().padStart(2, '0')}/${dateObj1.getFullYear()}`;

                                var rawDate2 = user[8];
                                var dateObj2 = new Date(rawDate2);
                                var formattedDate2 = `${(dateObj2.getMonth() + 1).toString().padStart(2, '0')}/` +
                                    `${dateObj2.getDate().toString().padStart(2, '0')}/${dateObj2.getFullYear()}`;

                                var newRow = `
                            <tr>
                                <td>${user[9]}</td>
                                <td>${user[15]}</td>
                                <td>${user[10]}</td>
                                <td>${user[12]}</td>
                                <td>${user[16]}</td>
                                <td>${user[1]}</td>
                                <td>${user[2]}</td>
                                <td>${formattedDate1}</td>  <!-- Display formatted date 1 -->
                                <td>${formattedDate2}</td>  <!-- Display formatted date 2 -->
                                <td>${user[13]}</td>
                                <td>${user[4]}</td>
                                <td>${user[5]}</td>
                                <td>${user[3]}</td>
                                <td><input type="checkbox" ${user[11] === 1 ? "checked" : "disabled"}></td>
                                <td><input type="checkbox" ${user[14] === 1 ? "checked" : "disabled"}></td>
                            </tr>`;
                                tableBody.append(newRow);
                            });
                        }
                    },
                    error: function (error) {
                        // Handle any errors
                        console.error(error);
                    }
                });
            });
        });

    </script>

<script>
    document.getElementById("searchInput").addEventListener("keyup", function() {
        var input, filter, div, p, i, txtValue;
        input = document.getElementById('searchInput');
        filter = input.value.toUpperCase();
        div = document.getElementsByClassName("inst")[0];
        p = div.getElementsByTagName('p');

        for (i = 0; i < p.length; i++) {
            txtValue = p[i].textContent || p[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                p[i].style.display = "";
            } else {
                p[i].style.display = "none";
            }
        }
    });
</script>
   
    <script>
        function initResizableColumns() {
            const headers = document.querySelectorAll('th.resize');

            headers.forEach(header => {
                let startX;
                let startWidth;

                header.addEventListener('mousedown', function (event) {
                    startX = event.clientX;
                    startWidth = header.offsetWidth;

                    document.addEventListener('mousemove', resizeColumn);
                    document.addEventListener('mouseup', stopResize);
                });

                function resizeColumn(event) {
                    const newWidth = startWidth + (event.clientX - startX);
                    header.style.width = newWidth + 'px';
                }

                function stopResize() {
                    document.removeEventListener('mousemove', resizeColumn);
                    document.removeEventListener('mouseup', stopResize);
                }
            });
        }

        window.addEventListener('DOMContentLoaded', initResizableColumns);
    </script>




</body>

</html>